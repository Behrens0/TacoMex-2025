<ion-content class="register-page">
  <div class="center-wrapper">
    <div class="register-container">
      <img src="assets/TacoMex.png" alt="Logo" class="login-logo" />

      <h2 class="register-subtitle">¡BIENVENIDO!</h2>

      <!-- Cliente -->
      <form *ngIf="tipoRegistro==='cliente'" [formGroup]="clienteForm" (ngSubmit)="registrarCliente()">
        <ion-item lines="none">
          <ion-label>¿Deseas ser un cliente anónimo?</ion-label>
          <ion-checkbox slot="end" [(ngModel)]="esAnonimo" (ionChange)="alternarAnonimato()"></ion-checkbox>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>

        <ng-container *ngIf="!esAnonimo">
          <ion-item>
            <ion-icon slot="start" name="mail-outline"></ion-icon>
            <ion-label position="floating">Correo electrónico</ion-label>
            <ion-input type="email" formControlName="correo"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
            <ion-label position="floating">Contraseña</ion-label>
            <ion-input type="password" formControlName="contrasenia"></ion-input>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="card-outline"></ion-icon>
            <ion-label position="floating">DNI</ion-label>
            <ion-input type="text" formControlName="dni"></ion-input>
            <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
              Escanear
            </ion-button>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="card-outline"></ion-icon>
            <ion-label position="floating">CUIL</ion-label>
            <ion-input type="text" formControlName="cuil"></ion-input>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="camera-outline"></ion-icon>
            <ion-label>Foto</ion-label>
            <ion-button slot="end" size="small" class="boton-verde" (click)="fileInput.click()">Subir Imagen</ion-button>
            <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
            <input #fileInput type="file" accept="image/*" style="display: none" (change)="onImagenSeleccionada($event)" />
            <ng-container *ngIf="imagenURL">
              <ion-icon name="checkmark-circle" color="success" style="margin-left:8px;font-size:1.5em;"></ion-icon>
              <img [src]="imagenURL" alt="preview" style="width:32px;height:32px;border-radius:50%;margin-left:4px;" />
            </ng-container>
          </ion-item>
        </ng-container>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="clienteForm.invalid && !esAnonimo">
          REGISTRARME
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>

        <div class="register-link" *ngIf="!esAdmin">
          ¿Ya tenés cuenta?
          <a (click)="irAlLogin()">Iniciar sesión</a>
        </div>
      </form>

      <!-- Empleado -->
      <form *ngIf="tipoRegistro==='empleado'" [formGroup]="empleadoForm" (ngSubmit)="registrarEmpleado()">
        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input type="email" formControlName="correo"></ion-input>
        </ion-item>
        
          <ion-item>
            <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
            <ion-label position="floating">Contraseña</ion-label>
            <ion-input type="password" formControlName="contrasenia"></ion-input>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="card-outline"></ion-icon>
            <ion-label position="floating">DNI</ion-label>
            <ion-input type="text" formControlName="dni"></ion-input>
            <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
              Escanear
            </ion-button>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="card-outline"></ion-icon>
            <ion-label position="floating">CUIL</ion-label>
            <ion-input type="text" formControlName="cuil"></ion-input>
          </ion-item>

          <ion-item>
            <ion-icon slot="start" name="camera-outline"></ion-icon>
            <ion-label>Foto</ion-label>
            <ion-button slot="end" size="small" class="boton-verde" (click)="fileInput.click()">Subir Imagen</ion-button>
            <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
            <input #fileInput type="file" accept="image/*" style="display: none" (change)="onImagenSeleccionada($event)" />
            <ng-container *ngIf="imagenURL">
              <ion-icon name="checkmark-circle" color="success" style="margin-left:8px;font-size:1.5em;"></ion-icon>
              <img [src]="imagenURL" alt="preview" style="width:32px;height:32px;border-radius:50%;margin-left:4px;" />
            </ng-container>
          </ion-item>

          <ion-item lines="none">
            <ion-label>Perfil</ion-label>
            <div class="perfil-checkboxes">
              <ion-checkbox
                [checked]="empleadoForm.get('perfil')?.value === 'maitre'"
                (ionChange)="empleadoForm.get('perfil')?.setValue('maitre')"
              >Maitre</ion-checkbox>
              <ion-checkbox
                [checked]="empleadoForm.get('perfil')?.value === 'mozo'"
                (ionChange)="empleadoForm.get('perfil')?.setValue('mozo')"
              >Mozo</ion-checkbox>
              <ion-checkbox
                [checked]="empleadoForm.get('perfil')?.value === 'cocinero'"
                (ionChange)="empleadoForm.get('perfil')?.setValue('cocinero')"
              >Cocinero</ion-checkbox>
              <ion-checkbox
                [checked]="empleadoForm.get('perfil')?.value === 'bartender'"
                (ionChange)="empleadoForm.get('perfil')?.setValue('bartender')"
              >Bartender</ion-checkbox>
            </div>
          </ion-item>
        
        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="empleadoForm.invalid">
          REGISTRAR EMPLEADO
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>

        <div class="register-link" *ngIf="!esAdmin">
          ¿Ya tenés cuenta?
          <a (click)="irAlLogin()">Iniciar sesión</a>
        </div>
      </form>
      <!-- Formulario de Alta de Mesa -->
      <form *ngIf="tipoRegistro==='mesa'" [formGroup]="mesaForm" (ngSubmit)="registrarMesa()">
        <!-- NÚMERO DE MESA -->
        <ion-item>
          <ion-icon slot="start" name="grid-outline"></ion-icon>
          <ion-label position="floating">Número de mesa</ion-label>
          <ion-input type="number" formControlName="numero"></ion-input>
        </ion-item>

        <!-- CANTIDAD DE COMENSALES -->
        <ion-item>
          <ion-icon slot="start" name="people-outline"></ion-icon>
          <ion-label position="floating">Cantidad de comensales</ion-label>
          <ion-input type="number" formControlName="comensales"></ion-input>
        </ion-item>

        <!-- TIPO DE MESA -->
        <ion-item>
          <ion-icon slot="start" name="star-outline"></ion-icon>
          <ion-label position="floating">Tipo de mesa</ion-label>
          <ion-select formControlName="tipo">
            <ion-select-option value="estandar">Estándar</ion-select-option>
            <ion-select-option value="vip">VIP</ion-select-option>
            <ion-select-option value="discapacitados">Para discapacitados</ion-select-option>
          </ion-select>
        </ion-item>

        <!-- FOTO DE LA MESA -->
        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="fileInputMesa.click()">Subir Imagen</ion-button>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
          <input #fileInputMesa type="file" accept="image/*" style="display: none" (change)="onImagenSeleccionada($event)" />
          <ng-container *ngIf="imagenURL">
            <ion-icon name="checkmark-circle" color="success" style="margin-left:8px;font-size:1.5em;"></ion-icon>
            <img [src]="imagenURL" alt="preview" style="width:32px;height:32px;border-radius:50%;margin-left:4px;" />
          </ng-container>
        </ion-item>

        <!-- QR GENERADO -->
        <ion-item *ngIf="qrMesaURL">
          <ion-label>QR generado</ion-label>
          <img [src]="qrMesaURL" alt="QR Mesa" style="width:64px;height:64px;margin-left:8px;" />
        </ion-item>

        <!-- ERROR -->
        <div class="error-message" *ngIf="mensajeErrorMesa">{{ mensajeErrorMesa }}</div>

        <!-- ENVIAR REGISTRO -->
        <ion-button expand="block" type="submit" [disabled]="mesaForm.invalid">
          REGISTRAR MESA
        </ion-button>

        <div *ngIf="mensajeExitoMesa" class="mensaje-exito">
          {{ mensajeExitoMesa }}
        </div>
      </form>
      <!-- Supervisor -->
      <form *ngIf="tipoRegistro==='supervisor'" [formGroup]="supervisorForm" (ngSubmit)="registrarSupervisor()">
        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input type="email" formControlName="correo"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" formControlName="contrasenia"></ion-input>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">DNI</ion-label>
          <ion-input type="text" formControlName="dni"></ion-input>
          <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
            Escanear
          </ion-button>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">CUIL</ion-label>
          <ion-input type="text" formControlName="cuil"></ion-input>
        </ion-item>

        <ion-item lines="none">
          <ion-label>Perfil</ion-label>
          <div class="perfil-checkboxes">
            <ion-checkbox
              [checked]="supervisorForm.get('perfil')?.value === 'dueño'"
              (ionChange)="supervisorForm.get('perfil')?.setValue('dueño')"
            >Dueño</ion-checkbox>
            <ion-checkbox
              [checked]="supervisorForm.get('perfil')?.value === 'supervisor'"
              (ionChange)="supervisorForm.get('perfil')?.setValue('supervisor')"
            >Supervisor</ion-checkbox>
          </div>
        </ion-item>

        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="fileInputSupervisor.click()">Subir Imagen</ion-button>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
          <input #fileInputSupervisor type="file" accept="image/*" style="display: none" (change)="onImagenSeleccionada($event)" />
          <ng-container *ngIf="imagenURL">
            <ion-icon name="checkmark-circle" color="success" style="margin-left:8px;font-size:1.5em;"></ion-icon>
            <img [src]="imagenURL" alt="preview" style="width:32px;height:32px;border-radius:50%;margin-left:4px;" />
          </ng-container>
        </ion-item>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="supervisorForm.invalid">
          REGISTRAR SUPERVISOR
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

      <div *ngIf="esAdmin" class="registro-selector">
        <ion-button size="small" [color]="tipoRegistro==='supervisor' ? 'success' : 'medium'" (click)="setTipoRegistro('supervisor')">Supervisores</ion-button>
        <ion-button size="small" [color]="tipoRegistro==='empleado' ? 'success' : 'medium'" (click)="setTipoRegistro('empleado')">Empleados</ion-button>
        <ion-button size="small" [color]="tipoRegistro==='cliente' ? 'success' : 'medium'" (click)="setTipoRegistro('cliente')">Clientes</ion-button>
        <ion-button size="small" [color]="tipoRegistro==='mesa' ? 'success' : 'medium'" (click)="setTipoRegistro('mesa')">Mesas</ion-button>
      </div>
    </div>
  </div>
</ion-content>
